---
title: 在自己服务器上部署Rustdesk服务
author: 尘归尘|土归土
date: 2024-07-05
tags: [实践]
categories: 文
---

# 在自己服务器上部署Rustdesk服务

---

<u>*下面的官方文档是个坑，总是卡死，把电脑搞死机，都要崩溃了后面另外找了一种docker直接拉去镜像的方式成功了。*</u>

最近想研究一下手机远程手机怎么操作，看了一圈发现有个开源的软件rustdesk使用软件的服务发现在中国区域好像不能链接需要自己搭建服务。于是准备折腾一下。

找到官网教程按步骤进行如下操作

目标路径下创建文件夹

```
mkdir rustdesk
```

### 克隆版本库并构建 Docker 容器:

```
git clone https://github.com/rustdesk/rustdesk # 克隆Github存储库
cd rustdesk # 进入文件夹
docker build -t "rustdesk-builder" . # 构建容器
```

报如下错误

```
ERROR: "docker buildx build" requires exactly 1 argument.
See 'docker buildx build --help'.

Usage:  docker buildx build [OPTIONS] PATH | URL | -

Start a build
```

查到出错原因是命令最后需要***\*一个空格和一个点\****复制的时候没注意，即：

```
docker build -t "rustdesk-builder" .
```

### 构建 RustDesk 程序

然后, 每次需要构建应用程序时, 运行以下命令:

```
docker run --rm -it -v $PWD:/home/user/rustdesk -v rustdesk-git-cache:/home/user/.cargo/git -v rustdesk-registry-cache:/home/user/.cargo/registry -e PUID="$(id -u)" -e PGID="$(id -g)" rustdesk-builder
```

这里中间在第441文件处卡住了。导致服务器死机了。重启后继续运行正常了。重启好多回反复执行很多次。总是下几个卡一会。执行几个步骤就卡死。



请注意:

- 因为需要缓存依赖项，首次构建一般很慢（国内网络会经常出现拉取失败，可以多试几次）。

- 如果您需要添加不同的构建参数，可以在指令末尾的`<OPTIONAL-ARGS>` 位置进行修改。例如构建一个"Release"版本，在指令后面加上` --release`即可。

- 如果出现以下的提示，则是无权限问题，可以尝试把

  ```
  -e PUID="$(id -u)" -e PGID="$(id -g)"
  ```

  参数去掉。

  ```
  usermod: user user is currently used by process 1
  groupmod: Permission denied.
  groupmod: cannot lock /etc/group; try again later.
  ```

  

  > **原因：** 容器的 entrypoint 脚本会检测 UID 和 GID，在度判和给定的环境变量的不一致时，会强行修改 user 的 UID 和 GID 并重新运行。但在重启后读不到环境中的 UID 和 GID，然后再次进入判错重启环节

### 运行 RustDesk 程序



生成的可执行程序在 target 目录下，可直接通过指令运行调试 (Debug) 版本的 RustDesk:

```
target/debug/rustdesk
```



或者您想运行发行 (Release) 版本:

```
target/release/rustdesk
```



请注意：

- 请保证您运行的目录是在 RustDesk 库的根目录内，否则软件会读不到文件。
- `install`、`run`等 Cargo 的子指令在容器内不可用，宿主机才行。

---

# 上面看不懂，下面是我另外找的方法。

## 拉取镜像

```bash
# 拉不动的请搜索“docker国内镜像站”修改镜像地址
sudo docker image pull rustdesk/rustdesk-server
```

## 开启hbbs

```bash
docker run --name hbbs -p 21115:21115 -p 21116:21116 -p 21116:21116/udp -p 21118:21118 -v `pwd`:/root -it --net=host --rm rustdesk/rustdesk-server hbbs -r 8.217.217.218
```

## 开启hbbr

```bash
docker run --name hbbr -p 26117:21117 -p 26119:21119 -v [你的自定义地址/hbbr]:/root -td rustdesk/rustdesk-server hbbr
```

将hhbs,hhbr配置为shell脚本注册成服务进行自启动

### 获取默认key

```bash
# 1.进入镜像
sudo docker exec -it hbbs bash 
# 2.获取key
cat ./id_ed25519.pub 
```

### 最后

在rustdesk中配置好就行

8.8.8.8:21116
8.8.8.8:21117

在点文件中获取的key./id_ed25519.pub 
